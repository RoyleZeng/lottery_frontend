# 抽獎系統功能更新說明

## 更新日期

2024 年 11 月

## 新增功能

### 1. 刪除抽獎活動功能

#### 功能描述

- 在活動列表中，每個活動現在都有刪除按鈕
- 點擊刪除按鈕會進行軟刪除（設置 `is_deleted` 為 true，不會真正從資料庫中刪除）
- 刪除前會有確認對話框

#### 使用方式

1. 在活動選擇頁面，找到要刪除的活動
2. 點擊活動右側的「刪除」按鈕
3. 在確認對話框中點擊「確定」來確認刪除

#### API 端點

- `DELETE /lottery/events/{event_id}` - 軟刪除抽獎活動

### 2. 測試邮件功能

#### 功能描述

- 在寄送中獎通知郵件前，可以先寄送測試郵件
- 可以指定多個測試收件人
- 使用虛擬的中獎者資料進行測試
- 測試郵件使用與正式郵件相同的模板和設定

#### 使用方式

1. 在中獎名單頁面點擊「寄送郵件」按鈕
2. 設定好郵件配置和內容
3. 點擊「測試寄送」按鈕
4. 在測試郵件對話框中輸入測試收件人的郵箱地址（一行一個）
5. 點擊「發送測試郵件」

#### 測試資料

系統會使用以下虛擬資料發送測試郵件：

- **得獎人姓名：** 測試用戶
- **學號：** TEST001
- **系所：** 測試系所
- **年級：** 測試年級
- **獎項：** 測試獎品

#### API 端點

- `POST /email/test-winners/{event_id}` - 發送測試中獎通知郵件

## 介面改進

### 活動列表介面

- 每個活動現在顯示更多資訊：
  - 活動狀態
  - 活動日期
  - 刪除按鈕
- 活動項目重新設計，更清晰地區分內容區域和操作區域

### 郵件功能介面

- 在郵件設定對話框中新增「測試寄送」按鈕
- 新增測試郵件對話框，包含：
  - 測試收件人輸入區域
  - 測試資料說明
  - 發送測試郵件按鈕

## 技術實現

### 前端更新

- **src/stores/lottery.js** - 新增 `deleteEvent` 和 `testWinnersNotification` 方法
- **src/views/LotteryView.vue** - 更新介面和新增相關方法
- 新增 CSS 樣式支援新的介面設計

### API 集成

- 更新 swagger 文档地址到 `http://localhost:8000/api/spec/doc`
- 集成新的刪除活動和測試郵件 API 端點
- 正確處理 API 回應和錯誤訊息

## 注意事項

1. **刪除活動**

   - 刪除是軟刪除，資料不會真正從資料庫中移除
   - 刪除操作不可復原（除非透過後端恢復功能）
   - 刪除後活動會從列表中移除

2. **測試郵件**

   - 測試郵件會使用與正式郵件相同的 SMTP 設定
   - 確保輸入的測試郵箱地址有效
   - 測試郵件的內容會使用虛擬資料替換模板變數

3. **相容性**
   - 新功能與現有功能完全相容
   - 不會影響現有的抽獎流程
   - 保持向後相容性
